                       <style type="text/css">
  .tt-menu { width:300px; }
  ul.typeahead.dropdown-menu li a {padding: 10px !important;  border-bottom:#CCC 1px solid;color:#000;}
  ul.typeahead.dropdown-menu li:last-child a { border-bottom:0px !important; }
  .demo-label {font-size:1.5em;color: #686868;font-weight: 500;color:#FFF;}
  .dropdown-menu>.active>a, .dropdown-menu>.active>a:focus, .dropdown-menu>.active>a:hover {
    text-decoration: none;
    background-color: #F8F9FB;
    outline: 0;
  }
                       </style>
                       <div class="row mt-4">
        <div class="col-lg-12 col-md-12 col-sm-12 col-12 mx-auto">
          <div class="grid">
            <div class="grid-body">
              <h2 class="mb-4 text-center">Patient Profile</h2>
              <div class="row">
                <div class="col-lg-3 col-md-5 col-sm-6 col-12 mx-auto form-wrapper">
                    <div class="patient-profile">
  <div class="user-profile">
    <div class="display-avatar animated-avatar">
      <!-- <img class="profile-img img-lg rounded-circle" src="../static/images/profile/male/image_1.png" alt="profile image"> -->
      <h1 class="profile-img text-white" style="line-height: 1.2em;" id="n">P</h1>
    </div>
    <div class="info-wrapper">
      <p class="user-name" id="pname">Pulkit Batheja</p>
      <h6 class="display-income" id="prn">PIET16CE083</h6>
    </div>
    <div class="table-responsive">
                      <table class="table info-table">
                        <tbody>
                          <tr>
                            <th>Gender</th>
                            <td id="pgender" class="text-left">Male</td>
                          </tr>
                          <tr>
                            <th>Mobile</th>
                            <td id="pmobile" class="text-left">9713054321</td>
                          </tr>
                          <tr>
                            <th>Address</th>
                            <td id="paddress" class="text-left">Sitapura, Jaipur</td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                    
                      <button class="btn btn-outline-danger component-flat" type="button" data-toggle="collapse" data-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">Refer to IPD</button>
                      <div class="collapse" id="collapseExample">
  <div class="card card-body">
   <div class="form-group">
                      <input type="text" class="form-control" id="reasonform" name="completeaddress" placeholder="Reason" />
                      <button onclick="refer();" id="ipdrefer"  class="btn btn-outline-warning mt-2" type="button" >Submit</button>
                    </div>
  </div>
</div>
                     
                      <button class="btn btn-outline-warning mt-2" type="button" >Transfer patient</button>
                                       
                    
  </div>
</div>
                </div>
                <div class="col-lg-9 col-md-7 col-sm-8 col-12 mx-auto form-wrapper">
                    <div class="grid">
                  <div class="grid-body">
                    <div class="split-header">
                      <p class="card-title">Current Query</p>
                      <span class="btn action-btn btn-xs component-flat" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <i class="mdi mdi-dots-vertical mdi-2x"></i>
                        <div class="dropdown-menu dropdown-menu-right">
                          <a class="dropdown-item" href="#">Complete Profile</a>
                          <a class="dropdown-item" href="#">Reports</a>
                          <a class="dropdown-item" href="#">Patients Visits</a>
                        </div>
                      </span>
                    </div>
                    <form id="prescription_form" autocomplete="off">
                    <div class="d-flex flex-row align-items-end mt-2">
                      <div class="col-lg-6 col-md-6 col-sm-6 col-6 mx-auto form-wrapper">
                      <p class="ml-1 font-weight-bold">Prescription Number: <span id="ppid" class="font-weight-normal">11234568</span></p>
                    </div>
                    <div class="col-lg-6 col-md-6 col-sm-6 col-6 mx-auto form-wrapper">
                      <p class="ml-1 font-weight-bold">Date: <span id="pdate" class="font-weight-normal">11234568</span></p>
                    </div>
                    </div>
                    <div class="d-flex flex-row align-items-end mt-2">
                      <div class="col-lg-6 col-md-6 col-sm-6 col-6 mx-auto form-wrapper">
                      <p class="ml-1 font-weight-bold">Age: <span id="page" class="font-weight-normal">11234568</span></p>
                    </div>
                    <div class="col-lg-6 col-md-6 col-sm-6 col-6 mx-auto form-wrapper">
                      <p class="ml-1 font-weight-bold">Reason: <span id="preason" class="font-weight-normal">11234568</span></p>
                    </div>
                    </div>
                    <div class="d-flex flex-row mt-4 mb-4">
                       <div class="col-lg-6 col-md-6 col-sm-6 col-6 mx-auto form-wrapper">
                    <div class="form-group">
                      <input type="text" class="form-control" name="patient_weight" placeholder="Patient Weight" />
                    </div>
                  </div>
                  <div class="col-lg-6 col-md-6 col-sm-6 col-6 mx-auto form-wrapper">
                    <div class="form-group">
                      <input type="text" class="form-control" name="patient_problem" placeholder="Problem" />
                    </div>
                  </div>
                    </div>
                    <div id="prescollap">
                    <div class="d-flex flex-row mt-4 mb-4">
                      <button class="btn btn-outline-light text-gray component-flat w-50 mr-2" type="button" data-toggle="collapse" data-target="#prescriptioncollapse" aria-expanded="false" aria-controls="prescriptioncollapse" data-parent="#prescollap">Add Presciption</button>
                     
                      <button class="btn btn-outline-light text-gray w-50 ml-2" type="button" data-toggle="collapse" data-target="#testcollapse" aria-expanded="false" aria-controls="testcollapse" data-parent="#prescollap">Suggest Tests</button>
                                       
                    </div>
                     <div class="collapse" id="prescriptioncollapse">
  <div class="card card-body">
    <div class="form-group row d-none">
      <div class="col-md-3 showcase_text_area">
          <label for="inputEmail10">Add more row</label>
      </div>
      <div class="col-md-9 showcase_content_area">
      <select id="pres" class="custom-select">
      <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
    </select></div>
  </div>

    <table class="table table-hover table-responsive" id="presTable">
        <thead>
            <tr>
                <th>Medicine Name</th>
                <th>Strength</th>
                <th>Dosage</th>
                <th>Others</th>
            </tr>
        </thead>
        <tr class="presRow" id="presRow">
            <td><input type="text" name ="medicinename" autocomplete="false" id="mediname"  class="form-control mediname"></td>
            <td><input type="text" name ="medicinestrength" class="form-control"></td>
            <td><input type="text" name ="medicinedosage" class="form-control"></td>
            <td><input type="text" name ="medicineothers" class="form-control"></td>
            <td><div class="btn action-btn btn-like btn-outline-danger btn-rounded removepres">
                          <i class="mdi mdi-delete-forever"></i>
                        </div></td>
        </tr>
        <tr id="addButtonRowpres">
            <td colspan="4"><center><div class="btn social-icon-btn btn-outline-secondary btn-rounded addpres">
                          <i class="mdi mdi-plus"></i>
                        </div></center></td>
        </tr>
</table>
  </div>
</div>

<div class="collapse" id="testcollapse">
    <div class="card card-body">
    <div class="form-group row d-none">
      <div class="col-md-3 showcase_text_area">
          <label for="inputEmail10">Add more row</label>
      </div>
      <div class="col-md-9 showcase_content_area">
      <select id="testpres" class="custom-select">
      <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
    </select></div>
  </div>

    <table class="table table-hover" id="testpresTable">
        <thead>
            <tr>
                <th>Test Name</th>
                <th>Others</th>
            </tr>
        </thead>
        <tr class="testpresRow">
            <td><input type="text" name="testname" class="form-control"></td>
            <td><input type="text" name="testothers" class="form-control"></td>
            <td><div class="btn action-btn btn-like btn-outline-danger btn-rounded removetestpres">
                          <i class="mdi mdi-delete-forever"></i>
                        </div></td>
        </tr>
        <tr id="addButtonRowtestpres">
            <td colspan="4"><center><div class="btn social-icon-btn btn-outline-secondary btn-rounded addtestpres">
                          <i class="mdi mdi-plus"></i>
                        </div></center></td>
        </tr>
</table>
  </div>
</div>
</div>
       <div class="row">
                <div class="col-lg-7 col-md-8 col-sm-9 col-12 mx-auto form-wrapper">
                    <button type="submit" class="btn btn-primary btn-block" id="subbtn"> Submit </button>
                  </div>
                </div>
              </form>
                  </div>
                </div>
                  </div>
                </div>
                       
              </div>
          </div>
        </div>
      </div>
<script>
  function refer(){
    $(document).ready(function() {
     document.getElementById('ipdrefer').innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span><span class="sr-only">Loading...</span>';
      document.getElementById('ipdrefer').setAttribute("disabled", "disabled");
     var ppid = document.getElementById('ppid').innerHTML;
     var reason = document.getElementById('reasonform').value; 
     $.ajax({
      type : 'POST',
      url : 'http://localhost:5000/ipdrefer?ppid='+ppid+'',
      data : {'data':reason},
      cache: false
    })
    .done(function(data) {

      if (data.error) {
        document.getElementById('ipdrefer').innerHTML = 'Please Try Again';

      }

      else {
          document.getElementById('ipdrefer').innerHTML = 'Ward Clerk Notified';        
      }

  });
});
   }
</script>
      <script type="text/javascript">
    $(document).ready(function() {

  $('#prescription_form').on('submit', function(event) {
    document.getElementById('subbtn').innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span><span class="sr-only">Loading...</span>';
   var ppid = document.getElementById('ppid').innerHTML;
    $.ajax({
      data : $('#prescription_form').serialize(),
      type : 'POST',
      url : 'http://localhost:5000/prescription-submit?ppid='+ppid+''
    })
    .done(function(data) {

      if (data.error) {
        $('#prescription_form').replaceWith("<div id='regform'><img style='width: 15%;display: block;margin: auto;' src='/static/img/sad.gif'/><br><h3 class='text-white text-center'>OOPS..!! Please try again.</h3></div>");
      }
      else {
        $('#prescription_form').replaceWith('<div id="opdform"><div class="patient-profile"><div class="user-profile"><div class="col-lg-6 col-md-7 col-sm-8 col-12 mx-auto form-wrapper"><div class="display-avatar animated-avatar"><!-- <img class="profile-img img-lg rounded-circle" src="../static/images/profile/male/image_1.png" alt="profile image"> --><h1 class="profile-img text-white" style="line-height: 1.2em;"><i class="mdi mdi-checkbox-marked-circle-outline"></i></h1></div><h3>Prescription Successfully Submitted</h3></div></div></div></div>');
      }

    });

    event.preventDefault();

  });

});
</script>
      <script>
        $(document).ready(function() {
          var url = new URL(window.location.href);

var query_string = url.search;

var search_params = new URLSearchParams(query_string); 

var prn = search_params.get('prn');


                $.ajax({
                  type: "POST",
                  url: "http://localhost:5000/patientinfo?prn="+prn+"",
                  processData:false,
                  cache: false,
                  success: function(row) {
                    var prn = '';
                    var pname = '';
                    var pmobile = '';
                    var page = '';
                    var pgender = '';
                    var pdate = '';
                    var preason = '';
                    var d = new Date();
                    var n = ''
          $.each(row, function (key,value) {
          prn =  value.patient_relationship_number;
          pname =  value.patient_name;
          pmobile =  value.patient_mobile;
          page =  value.patient_age;
          pgender =  value.patient_gender;
          paddress =  value.patient_address;
          preason =  value.patient_reason;
          ppid = value.prescription_no;
          n = value.patient_name.charAt(0).toUpperCase();

           });
              $('#prn').html(prn);
              $('#pname').html(pname);
              $('#pmobile').html(pmobile);
              $('#page').html(page);
              $('#pgender').html(pgender);
              $('#paddress').html(paddress);
              $('#preason').html(preason);
              $('#ppid').html(ppid);
              $('#n').html(n);
              $('#pdate').html(d.toDateString());
        
              history.back();

                  },
                  error: function(jqXHR, textStatus, errorThrown) {
                     $('#Notification').show();
                     $("#Notification").html(textStatus + " " + errorThrown);
                  }
               });
            });

      </script>


      <script>// Form copy
/* Variables */
var p = $("#pres").val();
var row = $(".presRow");

/* Functions */
function getP(){
  p = $("#pres").val();
}

function addRow() {
  row.clone(true, true).appendTo("#presTable").find("input[type='text']").val("");
  
}

function removeRow(button) {
  button.closest("tr").remove();
}
/* Doc ready */
$(".addpres").on('click', function () {
  getP();
  if($("#presTable tr").length < 17) {
    addRow();
    var i = Number(p)+1;
    $("#pres").val(i);
  }
  $(this).closest("tr").appendTo("#presTable");
  if ($("#presTable tr").length === 3) {
    $(".removepres").hide();
  } else {
    $(".removepres").show();
  }
});
$(".removepres").on('click', function () {
  getP();
  if($("#presTable tr").length === 3) {
    //alert("Can't remove row.");
    $(".removepres").hide();
  } else if($("#presTable tr").length - 1 ==3) {
    $(".removepres").hide();
    removeRow($(this));
    var i = Number(p)-1;
    $("#pres").val(i);
  } else {
    removeRow($(this));
    var i = Number(p)-1;
    $("#pres").val(i);
  }
});
$("#pres").change(function () {
  var i = 0;
  p = $("#pres").val();
  var rowCount = $("#presTable tr").length - 2;
  if(p > rowCount) {
    for(i=rowCount; i<p; i+=1){
      addRow();



    }
    $("#presTable #addButtonRowpres").appendTo("#presTable");
  } else if(p < rowCount) {
  }
});



/* Variables */
var p1 = $("#testpres").val();
var row1 = $(".testpresRow");

/* Functions */
function getP1(){
  p1 = $("#testpres").val();
}

function addRow1() {
  row1.clone(true, true).appendTo("#testpresTable");
}

function removeRow1(button) {
  button.closest("tr").remove();
}
/* Doc ready */
$(".addtestpres").on('click', function () {
  getP1();
  if($("#testpresTable tr").length < 17) {
    addRow1();
    var i = Number(p1)+1;
    $("#testprespres").val(i);
  }
  $(this).closest("tr").appendTo("#testpresTable");
  if ($("#testpresTable tr").length === 3) {
    $(".removetestpres").hide();
  } else {
    $(".removetestpres").show();
  }
});
$(".removetestpres").on('click', function () {
  getP1();
  if($("#testpresTable tr").length === 3) {
    //alert("Can't remove row.");
    $(".removetestpres").hide();
  } else if($("#testpresTable tr").length - 1 ==3) {
    $(".removetestpres").hide();
    removeRow($(this));
    var i = Number(p1)-1;
    $("#testpres").val(i);
  } else {
    removeRow($(this));
    var i = Number(p1)-1;
    $("#testpres").val(i);
  }
});
$("#testpres").change(function () {
  var i = 0;
  p1 = $("#testpres").val();
  var rowCount1 = $("#testpresTable tr").length - 2;
  if(p1 > rowCount1) {
    for(i=rowCount1; i<p1; i+=1){
      addRow1();
    }
    $("#testpresTable #addButtonRowtestpres").appendTo("#testpresTable");
  } else if(p1 < rowCount1) {
  }
});


// Form copy
</script>


<script>
    $(document).ready(function () {
        $('#mediname').typeahead({
            source: function (query, result) {
                $.ajax({
                    url: "http://localhost:5000/medis?query="+query,
                    type: "POST",
                    success: function (data) {
            result($.map(data, function (item) {
              return item['mname'];
                        }));
                    }
                });
            }
        });
    });
</script> 